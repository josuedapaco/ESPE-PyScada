$(function () {
  // Hacer los widgets arrastrables
  $(".widget").draggable({
    cursor: "move",
    stop: function (event, ui) {
      const id = $(this).attr("id");
      const position = ui.helper.position();

      // Guardar posición en localStorage
      localStorage.setItem(id + "_position", JSON.stringify(position));
    },
  });

  // Hacer los widgets redimensionables
  $(".widget").resizable({
    stop: function (event, ui) {
      const id = $(this).attr("id");
      const size = {
        width: ui.size.width,
        height: ui.size.height,
      };

      // Guardar tamaño en localStorage
      localStorage.setItem(id + "_size", JSON.stringify(size));
    },
  });

  // Hacer el área "droppable"
  $(".drop-area").droppable({
    accept: ".widget",
    drop: function (event, ui) {
      $(this).append(ui.draggable);
    },
  });

  // Restaurar posición y tamaño al cargar la página
  $(".widget").each(function () {
    const id = $(this).attr("id");

    // Restaurar posición guardada
    const savedPosition = localStorage.getItem(id + "_position");
    if (savedPosition) {
      const position = JSON.parse(savedPosition);
      $(this).css({
        top: position.top,
        left: position.left,
        position: "absolute",
      });
    }

    // Restaurar tamaño guardado
    const savedSize = localStorage.getItem(id + "_size");
    if (savedSize) {
      const size = JSON.parse(savedSize);
      $(this).css({
        width: size.width,
        height: size.height,
      });
    }
  });
});
